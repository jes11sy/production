# Настройка разработки

## Проблема с постоянными перезагрузками

Если вы видите постоянные сообщения `watchfiles.main - INFO - 1 change detected`, это означает, что uvicorn отслеживает изменения в файлах, которые не должны вызывать перезагрузку.

## Решение

### 1. Использование оптимизированного скрипта запуска

Вместо стандартного запуска:
```bash
uvicorn app.main:app --reload
```

Используйте один из вариантов:

**Рекомендуемый (минимальный):**
```bash
python run_dev_minimal.py
```

**Без логов в файл:**
```bash
python run_dev_no_logs.py
```

**Стандартный оптимизированный:**
```bash
python run_dev.py
```

Минимальный скрипт:
- Отслеживает только директорию `app/`
- Отключает логирование в файл
- Отключает мониторинг
- Максимально игнорирует изменения файлов

### 2. Ручная настройка uvicorn

Если хотите настроить самостоятельно:

```bash
uvicorn app.main:app \
  --reload \
  --reload-dir app \
  --reload-exclude "media/*" \
  --reload-exclude "*.log" \
  --reload-exclude "*.tmp" \
  --reload-exclude "__pycache__/*" \
  --reload-exclude "*.pyc"
```

### 3. Отключение мониторинга в разработке

Если мониторинг вызывает проблемы, можно временно отключить его:

```python
# В app/config.py
ENABLE_MONITORING: bool = False
```

## Что вызывает перезагрузки

1. **Файлы записей**: Сохраняются в `media/zayvka/zapis/`
2. **Загруженные файлы**: БСО, чеки в `media/zayvka/`
3. **Логи**: `app.log` и другие лог-файлы
4. **Кеш мониторинга**: Временные файлы системы мониторинга

## Мониторинг в разработке

Система мониторинга оптимизирована:
- Кеширование результатов на 60 секунд
- Неблокирующие вызовы psutil
- Минимальная нагрузка на систему

### Endpoints мониторинга:

- `GET /health` - Базовая проверка (быстрая)
- `GET /api/v1/health/detailed` - Полная проверка (админ)
- `GET /api/v1/health/metrics` - Системные метрики (админ)

## Производительность

После оптимизации:
- Базовый health check: ~5ms
- Полная проверка: ~50ms (с кешем)
- Отсутствие блокирующих операций
- Минимальная нагрузка на файловую систему 