# üóÑÔ∏è –°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic

–§–∞–π–ª `alembic.ini` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```ini
# –ü—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç–∞–º –º–∏–≥—Ä–∞—Ü–∏–π
script_location = alembic

# –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π (—Å –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º)
file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ slug
truncate_slug_length = 40

# –§–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ –≤–µ—Ä—Å–∏–∏
version_num_format = %04d
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è env.py

–§–∞–π–ª `alembic/env.py` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å:
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º PostgreSQL
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ò–º–ø–æ—Ä—Ç–æ–º –º–æ–¥–µ–ª–µ–π –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### CLI —É—Ç–∏–ª–∏—Ç–∞ (manage_migrations.py)

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
venv\Scripts\activate

# –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
python manage_migrations.py status

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã
python manage_migrations.py validate

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –º–∏–≥—Ä–∞—Ü–∏–π
python manage_migrations.py init

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
python manage_migrations.py create "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
python manage_migrations.py apply

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
python manage_migrations.py rollback <revision>

# –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
python manage_migrations.py history

# –ù–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage_migrations.py pending

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
python manage_migrations.py backup

# –¢–µ–∫—É—â–∞—è —Ä–µ–≤–∏–∑–∏—è
python manage_migrations.py current

# –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python manage_migrations.py check
```

### –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade -1

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
alembic history

# –¢–µ–∫—É—â–∞—è —Ä–µ–≤–∏–∑–∏—è
alembic current

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
alembic stamp head
```

## üöÄ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
```
GET /api/v1/migrations/status
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "data": {
    "current_revision": "001_initial_migration",
    "head_revision": "002_add_indexes",
    "is_up_to_date": false,
    "pending_migrations": ["002_add_indexes"],
    "pending_count": 1,
    "total_migrations": 2
  }
}
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```
POST /api/v1/migrations/apply
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "message": "–ú–∏–≥—Ä–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã",
  "data": {
    "backup_file": "/path/to/backup.sql",
    "applied_migrations": ["002_add_indexes"]
  }
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```
POST /api/v1/migrations/create?message=–û–ø–∏—Å–∞–Ω–∏–µ&autogenerate=true
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã
```
GET /api/v1/migrations/validate
```

### –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
```
GET /api/v1/migrations/history?limit=10
```

### –ù–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```
GET /api/v1/migrations/pending
```

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
```
POST /api/v1/migrations/rollback?revision=001
```

### –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
```
POST /api/v1/migrations/backup
```

## üìù –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
python manage_migrations.py create "Add user avatar field"
```

Alembic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª—è—Ö –∏ —Å–æ–∑–¥–∞—Å—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –º–∏–≥—Ä–∞—Ü–∏—é.

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Å—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
python manage_migrations.py create "Custom data migration" --no-autogenerate
```

### –ü—Ä–∏–º–µ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏

```python
"""Add user avatar field

Revision ID: 002
Revises: 001
Create Date: 2025-01-15 15:30:00.000000

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers
revision = '002'
down_revision = '001'
branch_labels = None
depends_on = None

def upgrade():
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è
    op.add_column('users', sa.Column('avatar_url', sa.String(500), nullable=True))
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
    op.create_index('ix_users_avatar_url', 'users', ['avatar_url'])

def downgrade():
    # –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
    op.drop_index('ix_users_avatar_url', table_name='users')
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—è
    op.drop_column('users', 'avatar_url')
```

## üîÑ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
python manage_migrations.py status

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
python manage_migrations.py apply

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–≤–∏–∑–∏–∏
python manage_migrations.py apply --revision 002
```

### –ü—Ä–æ–¥–∞–∫—à–Ω

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
python manage_migrations.py backup

# –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
python manage_migrations.py check

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±—ç–∫–∞–ø–æ–º
python manage_migrations.py apply --backup
```

## ‚è™ –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–µ–≤–∏–∑–∏–∏

```bash
python manage_migrations.py rollback -1
```

### –û—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–≤–∏–∑–∏–∏

```bash
python manage_migrations.py rollback 001
```

### –û—Ç–∫–∞—Ç —Å —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–µ–π

```bash
python manage_migrations.py rollback 001 --backup
```

## üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –ø–µ—Ä–µ–¥:
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π
- –û—Ç–∫–∞—Ç–æ–º –º–∏–≥—Ä–∞—Ü–∏–π
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

```bash
python manage_migrations.py backup
```

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `backend/backups/` —Å –∏–º–µ–Ω–µ–º —Ñ–æ—Ä–º–∞—Ç–∞:
```
backup_20250115_153000.sql
```

## üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã

```bash
python manage_migrations.py validate
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `alembic_version`
- –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º—ã –æ–∂–∏–¥–∞–µ–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
python manage_migrations.py check
```

–í—ã–ø–æ–ª–Ω—è–µ—Ç:
- –í–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ö–µ–º—ã
- –ü—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ß–µ—Ä–µ–∑ API

```bash
# –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
curl -X GET "http://localhost:8000/api/v1/migrations/status" \
  -H "Authorization: Bearer <admin_token>"

# –ù–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
curl -X GET "http://localhost:8000/api/v1/migrations/pending" \
  -H "Authorization: Bearer <admin_token>"
```

### –ß–µ—Ä–µ–∑ CLI

```bash
# –ö—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å
python manage_migrations.py current

# –ü–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç–∞—Ç—É—Å
python manage_migrations.py status

# –ò—Å—Ç–æ—Ä–∏—è
python manage_migrations.py history --limit 20
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "–¢–∞–±–ª–∏—Ü–∞ alembic_version –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
python manage_migrations.py init
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–µ–≤–∏–∑–∏–π"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
python manage_migrations.py history

# –û—Ç–∫–∞—Ç –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–µ–≤–∏–∑–∏–∏
python manage_migrations.py rollback <stable_revision>

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python manage_migrations.py create "Fix migration conflict"
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
python manage_migrations.py validate

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
psql -h localhost -U user -d database -f backup_file.sql

# –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
python manage_migrations.py current

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–≤–∏–∑–∏–∏
alembic stamp head

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
python manage_migrations.py create "Sync schema"
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```python
# app/config.py
class DevelopmentConfig:
    DATABASE_URL = "postgresql+asyncpg://user:pass@localhost/dev_db"
    MIGRATION_AUTO_APPLY = True
    MIGRATION_BACKUP = False
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
class TestingConfig:
    DATABASE_URL = "postgresql+asyncpg://user:pass@localhost/test_db"
    MIGRATION_AUTO_APPLY = True
    MIGRATION_BACKUP = False
```

### –ü—Ä–æ–¥–∞–∫—à–Ω

```python
class ProductionConfig:
    DATABASE_URL = "postgresql+asyncpg://user:pass@prod-host/prod_db"
    MIGRATION_AUTO_APPLY = False
    MIGRATION_BACKUP = True
```

## üìã –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

1. **–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
   ```bash
   python manage_migrations.py create "Add user profile fields"
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
   ls -la alembic/versions/ | tail -1
   ```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –∫–æ–ø–∏–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

1. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏:** –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ
   ```bash
   python manage_migrations.py apply --backup
   ```

2. **–ü–æ—ç—Ç–∞–ø–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –í –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –ø–æ –æ–¥–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
   ```bash
   python manage_migrations.py apply --revision 002
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–∞—Ç–∞:** –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–∫–∞—Ç –Ω–∞ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö
2. **–ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç:** –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –ø–ª–∞–Ω –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –æ—Ç–∫–∞—Ç–∞

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```yaml
# .github/workflows/deploy.yml
- name: Run migrations
  run: |
    python manage_migrations.py check
    python manage_migrations.py apply --backup
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
#!/bin/bash
cd /path/to/backend
python manage_migrations.py status
if [ $? -ne 0 ]; then
    echo "Migration check failed"
    exit 1
fi
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- –ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç–∫–∞—Ç–æ–≤
- –†–∞–∑–º–µ—Ä —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

### –ê–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞:
- –ù–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ > 0
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ > 5 –º–∏–Ω—É—Ç
- –û—à–∏–±–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è

- –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- API —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

### –ê—É–¥–∏—Ç

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã
- –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Alembic](https://alembic.sqlalchemy.org/)
- [SQLAlchemy Migrations](https://docs.sqlalchemy.org/en/14/core/constraints.html)
- [PostgreSQL Backup and Restore](https://www.postgresql.org/docs/current/backup.html)

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- ‚úÖ –£–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CLI –∏ API
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—é –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å CI/CD

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤–æ –≤—Å–µ—Ö —Å—Ä–µ–¥–∞—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. 