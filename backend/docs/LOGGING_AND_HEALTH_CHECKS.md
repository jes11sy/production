# üìä –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –õ–û–ì–û–í –ò HEALTH CHECKS –í–ù–ï–®–ù–ò–• –°–ï–†–í–ò–°–û–í

## üîÑ –£–õ–£–ß–®–ï–ù–ò–Ø –°–ò–°–¢–ï–ú–´ –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø

### **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤:**

#### **1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –ø–æ —Ç–∏–ø–∞–º:**
- **`app.log`** - –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **`app_error.log`** - —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ (90 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- **`app_security.log`** - –ª–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (365 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- **`app_performance.log`** - –ª–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (30 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è)

#### **2. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ä–æ—Ç–∞—Ü–∏—è:**
```python
# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: RotatingFileHandler
- maxBytes: 10MB –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ª–æ–≥–æ–≤
- maxBytes: 5MB –¥–ª—è –æ—à–∏–±–æ–∫ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- backupCount: 5-10 —Ñ–∞–π–ª–æ–≤

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω: TimedRotatingFileHandler
- –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å
- –•—Ä–∞–Ω–µ–Ω–∏–µ: 30-365 –¥–Ω–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8
```

#### **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏:**
```json
{
  "timestamp": "2025-01-20T10:30:00.123456",
  "level": "INFO",
  "logger": "app.request",
  "message": "Request processed successfully",
  "module": "auth",
  "function": "login",
  "line": 45,
  "user_id": 123,
  "request_id": "req_abc123",
  "client_ip": "192.168.1.100",
  "method": "POST",
  "url": "/api/v1/auth/login",
  "status_code": 200,
  "response_time": 0.045
}
```

---

## üè• HEALTH CHECKS –í–ù–ï–®–ù–ò–• –°–ï–†–í–ò–°–û–í

### **–ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç: `/api/v1/health/external-services`**

#### **–ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**

1. **Redis** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–∞–º—è—Ç—å
2. **PostgreSQL** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
3. **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - –ø—Ä–∞–≤–∞ –∑–∞–ø–∏—Å–∏, —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
4. **–í–Ω–µ—à–Ω–∏–µ API** - –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
5. **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã** - CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫, —Å–µ—Ç—å

#### **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "timestamp": "2025-01-20T10:30:00.123456",
  "overall_status": "healthy",
  "summary": {
    "total": 5,
    "healthy": 4,
    "degraded": 1,
    "unhealthy": 0
  },
  "services": {
    "redis": {
      "status": "healthy",
      "response_time_ms": 12.5,
      "message": "Redis is operational",
      "details": {
        "connected": true,
        "response_time_ms": 12.5,
        "memory_usage": {
          "used_memory_human": "2.1M",
          "used_memory_peak_human": "2.5M"
        },
        "connected_clients": 3
      },
      "last_check": "2025-01-20T10:30:00.123456"
    },
    "database": {
      "status": "healthy",
      "response_time_ms": 45.2,
      "message": "Database is operational",
      "details": {
        "connected": true,
        "response_time_ms": 45.2,
        "total_requests": 15420,
        "recent_requests": 23,
        "pool_size": 20,
        "checked_in": 18,
        "checked_out": 2,
        "overflow": 0
      },
      "last_check": "2025-01-20T10:30:00.123456"
    },
    "file_system": {
      "status": "healthy",
      "response_time_ms": 8.1,
      "message": "File system is operational",
      "details": {
        "writable": true,
        "response_time_ms": 8.1,
        "free_space_gb": 45.2,
        "total_space_gb": 500.0,
        "used_percent": 9.0,
        "media_dir": "/app/media",
        "upload_dir": "/app/media/gorod/rashod",
        "recordings_dir": "/app/media/zayvka/zapis"
      },
      "last_check": "2025-01-20T10:30:00.123456"
    },
    "external_apis": {
      "status": "degraded",
      "response_time_ms": 1250.0,
      "message": "External APIs: 1/2 healthy",
      "details": {
        "total_services": 2,
        "healthy_services": 1,
        "response_time_ms": 1250.0,
        "services": [
          {
            "service": "rambler_imap",
            "status": 200,
            "response_time": "1.2s"
          },
          {
            "service": "email_service",
            "status": "error",
            "error": "Connection timeout"
          }
        ]
      },
      "last_check": "2025-01-20T10:30:00.123456"
    },
    "system_resources": {
      "status": "healthy",
      "response_time_ms": 15.3,
      "message": "System resources are within acceptable limits",
      "details": {
        "cpu_percent": 25.5,
        "memory_percent": 45.2,
        "memory_available_gb": 8.5,
        "disk_percent": 35.0,
        "disk_free_gb": 325.0,
        "network_bytes_sent": 1024000,
        "network_bytes_recv": 2048000,
        "response_time_ms": 15.3
      },
      "last_check": "2025-01-20T10:30:00.123456"
    }
  }
}
```

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
LOG_TO_FILE=true
LOG_FILE=logs/app.log

# Health checks
HEALTH_CHECK_INTERVAL=60  # —Å–µ–∫—É–Ω–¥—ã
HEALTH_CHECK_TIMEOUT=10   # —Å–µ–∫—É–Ω–¥—ã
```

### **–ü–æ—Ä–æ–≥–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤:**
- **HEALTHY**: –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- **DEGRADED**: –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- **UNHEALTHY**: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

---

## üîß –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8000/api/v1/health/external-services

# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8000/api/v1/health/

# –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8000/api/v1/health/detailed
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:**
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
tail -f logs/app.log

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
tail -f logs/app_error.log

# –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
tail -f logs/app_security.log

# –õ–æ–≥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
tail -f logs/app_performance.log
```

---

## üìà –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤:**
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –¥–ª—è –ª—É—á—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
- ‚úÖ –†–∞–∑–Ω—ã–µ —Å—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ª–æ–≥–æ–≤
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∫–∞–∂–¥–æ–º –ª–æ–≥–µ

### **Health checks –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:**
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## üöÄ –†–ï–ó–£–õ–¨–¢–ê–¢

**–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–ª–∞ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–π:**

1. **–õ–æ–≥–∏** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, —Ä–æ—Ç–∏—Ä—É–µ–º—ã–µ, —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –±—ã—Å—Ç—Ä–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º
4. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - —Ä–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π: 9.5/10** üéØ 